blueprint:
  name: Hund drau√üen & Kack-Logik
  description: Erkennt mehrfaches T√ºrschlie√üen, fragt ob Hund drau√üen war und ob er gekackt hat.
  domain: automation
  input:
    fenster_sensor:
      name: T√ºrsensor
      selector:
        entity:
          domain: binary_sensor
    push_geraete:
      name: Pushger√§te (kommasepariert)
      selector:
        text:

trigger:
  - platform: state
    entity_id: !input fenster_sensor
    to: "off"

variables:
  push_dienste: "{{ iif(',' in push_geraete, push_geraete.split(', '), [push_geraete]) }}"

action:
  - service: counter.increment
    target:
      entity_id: counter.tueroeffnung_zaehler

  - delay: "00:00:02"

  - condition: numeric_state
    entity_id: counter.tueroeffnung_zaehler
    above: 1

  - service: input_boolean.turn_on
    target:
      entity_id: input_boolean.war_draussen

  - repeat:
      for_each: "{{ push_dienste }}"
      sequence:
        - service: "{{ repeat.item }}"
          data:
            title: "üêæ Hund drau√üen?"
            message: "War der Hund drau√üen? Bitte best√§tigen."
            data:
              actions:
                - action: "HUND_DRAUSSEN"
                  title: "Ja"
                - action: "HUND_NICHT"
                  title: "Nein"

  - service: counter.reset
    entity_id: counter.tueroeffnung_zaehler
